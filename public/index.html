<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <!-- PWA –º–µ—Ç–∞—Ç–µ–≥–∏ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">


    <!-- –ò–∫–æ–Ω–∫–∏ –¥–ª—è iOS/Android -->

    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">

    <title>–ë–∞–ª–∞–Ω—Å —Ç–µ–ª–∞</title>
    <!-- –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 28px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: #667eea;
            outline: none;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .ai-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 40px;
        }

        .ai-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 15px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-size: 16px;
            font-weight: 600;
        }

        .ai-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .ai-button i {
            font-size: 32px;
            margin-bottom: 15px;
            display: block;
        }

        .result {
            margin-top: 30px;
            padding: 20px;
            background: #e8f4ff;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            display: none;
        }

        .result.active {
            display: block;
        }

        .result-title {
            color: #333;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .result-content {
            color: #555;
            line-height: 1.6;
            white-space: pre-line;
        }


        @media (max-width: 480px) {

            /* –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–±–∏–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
            .container {
                padding: 15px;
                margin: 10px;
                border-radius: 15px;
            }

            h1 {
                font-size: 22px;
                margin-bottom: 20px;
            }

            .form-section {
                padding: 20px;
            }

            .ai-buttons {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-top: 30px;
            }

            .ai-button {
                padding: 20px 10px;
                font-size: 15px;
            }

            .ai-button i {
                font-size: 28px;
                margin-bottom: 10px;
            }

            .radio-group {
                flex-direction: column;
                gap: 10px;
            }

            /* –ú–æ–¥–∞–ª–∫–∞ –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö */
            #ai-result-modal>div {
                width: 95%;
                max-width: 95%;
                padding: 20px;
                margin: 10px;
                max-height: 90vh;
            }

            #ai-result-modal h3 {
                font-size: 20px;
            }

            #ai-result-modal .buttons-container {
                flex-direction: column;
                gap: 10px;
            }

            #ai-result-modal button {
                width: 100%;
                justify-content: center;
            }

            /* –î–ª—è —ç–∫—Ä–∞–Ω–æ–≤ 380px –∏ –±–æ–ª—å—à–µ  */
            @media (min-width: 380px) {
                .ai-buttons {
                    grid-template-columns: repeat(2, 1fr);
                }

                .ai-button {
                    padding: 18px 12px;
                    font-size: 15px;
                }

                #ai-result-modal>div {
                    max-width: 380px;
                    margin: 20px auto;
                }

                #ai-result-modal .buttons-container {
                    flex-direction: row;
                    flex-wrap: wrap;
                }

                #ai-result-modal button {
                    flex: 1;
                    min-width: 100px;
                }

                .radio-label {
                    gap: 4px;
                }
            }
        }

        /* –î–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤  */
        @media (max-width: 380px) {
            .container {
                padding: 10px;
                margin: 5px;
            }

            input,
            select,
            textarea {
                padding: 10px 12px;
                font-size: 15px;
            }

            .ai-button {
                padding: 18px 8px;
                font-size: 14px;
            }

            label {
                font-size: 14px;
            }
        }

        /* –£–±—Ä–∞—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏ —Ç–∞–ø–µ */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        /* –§–∏–∫—Å –¥–ª—è iOS input zoom */
        input,
        select,
        textarea {
            font-size: 16px !important;
        }

        /* –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–æ–Ω—ã –Ω–∞ iPhone X+ */
        @supports (padding: max(0px)) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }

        @media print {

            /* –°–∫—Ä—ã–≤–∞–µ–º –≤—Å—ë –∫—Ä–æ–º–µ –º–æ–¥–∞–ª–∫–∏ */
            body * {
                visibility: hidden;
            }

            #ai-result-modal,
            #ai-result-modal * {
                visibility: visible;
            }

            #ai-result-modal {
                position: absolute !important;
                left: 0 !important;
                top: 0 !important;
                width: 100% !important;
                height: auto !important;
                background: white !important;
                box-shadow: none !important;
                padding: 0 !important;
                margin: 0 !important;
            }

            /* –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –ø–µ—á–∞—Ç–∏ */
            #ai-result-modal button {
                display: none !important;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <div class="container">
        <h1>üéØ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤</h1>

        <div class="form-section">
            <h2>üìù –§–æ—Ä–º–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
            <div class="form-group">
                <label for="test-name">–ò–º—è:</label>
                <input type="text" id="test-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
            </div>

            <div class="form-group">
                <label for="test-age">–í–æ–∑—Ä–∞—Å—Ç:</label>
                <input type="number" id="test-age" placeholder="–í–æ–∑—Ä–∞—Å—Ç" min="10" max="100">
            </div>

            <div class="form-group">
                <label for="test-weight">–í–µ—Å (–∫–≥):</label>
                <input type="number" id="test-weight" placeholder="–í–µ—Å –≤ –∫–≥" min="30" max="200">
            </div>

            <div class="form-group">
                <label for="test-height">–†–æ—Å—Ç (—Å–º):</label>
                <input type="number" id="test-height" placeholder="–†–æ—Å—Ç –≤ —Å–º" min="100" max="250">
            </div>

            <div class="form-group">
                <label>–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="test-activity" value="low" checked>
                        <span>–ù–∏–∑–∫–∞—è</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="test-activity" value="medium">
                        <span>–°—Ä–µ–¥–Ω—è—è</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="test-activity" value="high">
                        <span>–í—ã—Å–æ–∫–∞—è</span>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label for="test-goal">–¶–µ–ª—å:</label>
                <select id="test-goal">
                    <option value="weight-loss">–ü–æ—Ö—É–¥–µ–Ω–∏–µ</option>
                    <option value="muscle-gain">–ù–∞–±–æ—Ä –º–∞—Å—Å—ã</option>
                    <option value="endurance">–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å</option>
                    <option value="health">–û–∑–¥–æ—Ä–æ–≤–ª–µ–Ω–∏–µ</option>
                </select>
            </div>

            <div class="form-group">
                <label for="test-info">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</label>
                <textarea id="test-info" rows="3" placeholder="–û—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è, —Ç—Ä–∞–≤–º—ã, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è..."></textarea>
            </div>
        </div>

        <div class="ai-buttons">
            <button class="ai-button" id="trainer-btn">
                <i class="fas fa-dumbbell"></i>
                üéØ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä
                <div style="font-size: 14px; margin-top: 10px; opacity: 0.9;">–≠–ª–∏—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å</div>
            </button>

            <button class="ai-button" id="diet-btn">
                <i class="fas fa-apple-alt"></i>
                ü•ó –í—Ä–∞—á-–Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥
                <div style="font-size: 14px; margin-top: 10px; opacity: 0.9;">–°–∞–Ω–∞—Ç–æ—Ä–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å</div>
            </button>

            <button class="ai-button" id="energy-btn">
                <i class="fas fa-bolt"></i>
                ‚ö° –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —ç–Ω–µ—Ä–≥–∏–∏
                <div style="font-size: 14px; margin-top: 10px; opacity: 0.9;">–¶–∏—Ä–∫–∞–¥–Ω—ã–µ —Ä–∏—Ç–º—ã</div>
            </button>
        </div>


    </div>

    <div class="result" id="result">
        <div class="result-title" id="result-title"></div>
        <div class="result-content" id="result-content"></div>
    </div>

    <script>
        const API_URL = window.location.origin; // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–µ—Ä—ë—Ç —Ç–µ–∫—É—â–∏–π –¥–æ–º–µ–Ω

        console.log('üåê API URL:', API_URL);
        console.log('üöÄ –¢–µ—Å—Ç AI –∫–Ω–æ–ø–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω');

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–æ—Ä–º—ã
        function getTestFormData() {
            return {
                name: document.getElementById('test-name').value.trim(),
                age: parseInt(document.getElementById('test-age').value) || 0,
                weight: parseFloat(document.getElementById('test-weight').value) || 0,
                height: parseInt(document.getElementById('test-height').value) || 0,
                activity: document.querySelector('input[name="test-activity"]:checked').value,
                goal: document.getElementById('test-goal').value,
                additionalInfo: document.getElementById('test-info').value.trim()
            };
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã
        function validateForm(data) {
            if (!data.name || data.name.length < 2) {
                return '‚ùå –í–≤–µ–¥–∏—Ç–µ –∏–º—è (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)';
            }
            if (!data.age || data.age < 10 || data.age > 100) {
                return '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç (10-100 –ª–µ—Ç)';
            }
            if (!data.weight || data.weight < 30 || data.weight > 200) {
                return '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–µ—Å (30-200 –∫–≥)';
            }
            return null;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        function showResult(title, content) {
            alert(`–ü–æ–∫–∞–∑—ã–≤–∞—é: ${title}\n–î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞: ${content?.length}`);
            console.log('üö® showResult –≤—ã–∑–≤–∞–Ω!', title, content?.length);

            const resultDiv = document.getElementById('result');
            const titleDiv = document.getElementById('result-title');
            const contentDiv = document.getElementById('result-content');

            console.log('üîç –≠–ª–µ–º–µ–Ω—Ç—ã:', {
                resultDiv: !!resultDiv,
                titleDiv: !!titleDiv,
                contentDiv: !!contentDiv
            });

            if (!resultDiv || !titleDiv || !contentDiv) {
                console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞!');
                alert('–û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ');
                return;
            }

            titleDiv.textContent = title;
            contentDiv.textContent = content;
            resultDiv.classList.add('active');

            console.log('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –∫–ª–∞—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω');

            // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ AI
        async function sendAIRequest(endpoint, specialist, userData) {
            try {
                console.log(`üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ ${endpoint}:`, userData);

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        userData: userData,
                        timestamp: new Date().toISOString()
                    })
                });

                console.log('üì• –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:', data);

                return data;

            } catch (error) {
                console.error('üî• –û—à–∏–±–∫–∞:', error);
                throw error;
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç—Ä–µ–Ω–µ—Ä–∞
        document.getElementById('trainer-btn').addEventListener('click', async function () {
            const userData = getTestFormData();
            const error = validateForm(userData);

            if (error) {
                alert(error);
                return;
            }

            showResult('üéØ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç...', '–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω...');

            try {
                const result = await sendAIRequest('/api/trainer', '–¢—Ä–µ–Ω–µ—Ä', userData);
                // –ü–û–°–õ–ï –æ—Ç–≤–µ—Ç–∞ AI ‚Äî –∫—Ä–∞—Å–∏–≤–∞—è –º–æ–¥–∞–ª–∫–∞
                showAIResultModal(`üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Ç—Ä–µ–Ω–µ—Ä–∞`, result.advice, userData.name);
            } catch (error) {
                // –û—à–∏–±–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ –±–ª–æ–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                showResult('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ —Ç—Ä–µ–Ω–µ—Ä—É', error.message);
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–∏–µ—Ç–æ–ª–æ–≥–∞
        document.getElementById('diet-btn').addEventListener('click', async function () {
            const userData = getTestFormData();
            const error = validateForm(userData);

            if (error) {
                alert(error);
                return;
            }

            showResult('ü•ó –í—Ä–∞—á-–Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç...', '–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω...');

            try {
                const result = await sendAIRequest('/api/diet', '–î–∏–µ—Ç–æ–ª–æ–≥', userData);
                // –ü–û–°–õ–ï –æ—Ç–≤–µ—Ç–∞ AI ‚Äî –∫—Ä–∞—Å–∏–≤–∞—è –º–æ–¥–∞–ª–∫–∞
                showAIResultModal(`ü•ó –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–∏–µ—Ç–æ–ª–æ–≥–∞`, result.advice, userData.name);
            } catch (error) {
                showResult('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ –¥–∏–µ—Ç–æ–ª–æ–≥—É', error.message);
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —ç–Ω–µ—Ä–≥–∏–∏
        document.getElementById('energy-btn').addEventListener('click', async function () {
            const userData = getTestFormData();
            const error = validateForm(userData);

            if (error) {
                alert(error);
                return;
            }

            showResult('‚ö° –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —ç–Ω–µ—Ä–≥–∏–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç...', '–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω...');

            try {
                const result = await sendAIRequest('/api/energy', '–≠–Ω–µ—Ä–≥–∏—è', userData);
                // –ü–û–°–õ–ï –æ—Ç–≤–µ—Ç–∞ AI ‚Äî –∫—Ä–∞—Å–∏–≤–∞—è –º–æ–¥–∞–ª–∫–∞
                showAIResultModal(`‚ö° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —ç–Ω–µ—Ä–≥–∏–∏`, result.advice, userData.name);
            } catch (error) {
                showResult('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É', error.message);
            }
        });



        // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
        window.fillTestData = function () {
            document.getElementById('test-name').placeholder = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è, –Ω–∞–ø—Ä–∏–º–µ—Ä: –ê–ª–µ–∫—Å–∞–Ω–¥—Ä';
            document.getElementById('test-age').placeholder = '–í–≤–µ–¥–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä: 35';
            document.getElementById('test-weight').placeholder = '–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å –≤ –∫–≥, –Ω–∞–ø—Ä–∏–º–µ—Ä: 85';
            document.getElementById('test-height').placeholder = '–í–≤–µ–¥–∏—Ç–µ —Ä–æ—Å—Ç –≤ —Å–º, –Ω–∞–ø—Ä–∏–º–µ—Ä: 180';
            document.getElementById('test-info').placeholder = '–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É —Ü–µ–ª—å, –Ω–∞–ø—Ä–∏–º–µ—Ä: –•–æ—á—É —É–ª—É—á—à–∏—Ç—å –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å –∏ —Å–±—Ä–æ—Å–∏—Ç—å 10 –∫–≥';

            console.log('‚úÖ –ü—Ä–∏–º–µ—Ä—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');
        };

        // –ë—ã—Å—Ç—Ä–∞—è –∫–Ω–æ–ø–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏
        console.log('üí° –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∞ –≤–≤–µ–¥–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏: fillTestData()');

        // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        setTimeout(() => {
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                fillTestData();
                console.log('‚úÖ –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏');
            }
        }, 1000);

        // ==================== –°–û–•–†–ê–ù–ï–ù–ò–ï –ò –ü–ï–ß–ê–¢–¨ ====================

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è AI —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
        function saveAIAdvice(title, content) {
            try {
                const text = `=== ${title} ===\n\n${content}\n\n---\n–°–æ–∑–¥–∞–Ω–æ: ${new Date().toLocaleString()}\n`;
                const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `AI_—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏_${Date.now()}.txt`;
                document.body.appendChild(a);
                a.click();
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                alert(`‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ "${title}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!`);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞


        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑ –º–æ–¥–∞–ª–∫–∏
        function saveCurrentAdvice(title) {
            const contentDiv = document.querySelector('#ai-result-modal [style*="background: #f8f9ff"] div');
            if (contentDiv) {
                const content = contentDiv.textContent || contentDiv.innerText;
                saveAIAdvice(title, content);
            }
        }
        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º showResult
        const originalShowResult = showResult;
        showResult = function (title, content) {
            showAIResultModal(title, content, '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
        };

        function showAIResultModal(title, content, userName) {
            const isMobile = window.innerWidth <= 480;

            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –º–æ–¥–∞–ª–∫—É –µ—Å–ª–∏ –µ—Å—Ç—å
            const oldModal = document.getElementById('ai-result-modal');
            if (oldModal) oldModal.remove();

            const modalHTML = `
<div id="ai-result-modal" style="
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
    background: rgba(0,0,0,0.9); display: flex; justify-content: center; 
    align-items: ${isMobile ? 'flex-start' : 'center'}; 
    z-index: 10000; padding: ${isMobile ? '10px' : '20px'}; 
    box-sizing: border-box; overflow-y: auto;
">
    <div style="
        background: white; padding: ${isMobile ? '15px' : '25px'}; 
        border-radius: ${isMobile ? '12px' : '16px'}; 
        width: ${isMobile ? '100%' : '90%'}; 
        max-width: ${isMobile ? '100%' : '600px'}; 
        max-height: ${isMobile ? 'calc(100vh - 20px)' : '85vh'}; 
        overflow: hidden; display: flex; flex-direction: column;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        margin-top: ${isMobile ? '10px' : '0'};
    ">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="color: #667eea; margin: 0; font-size: ${isMobile ? '18px' : '22px'}; font-weight: 600;">
                ${title}
            </h3>
            <button onclick="document.getElementById('ai-result-modal').remove()" style="
                background: #f0f0f0; border: none; width: ${isMobile ? '32px' : '36px'}; 
                height: ${isMobile ? '32px' : '36px'}; border-radius: 50%; 
                font-size: ${isMobile ? '20px' : '24px'}; cursor: pointer;
                display: flex; align-items: center; justify-content: center;
                color: #666; padding: 0; line-height: 1; flex-shrink: 0;
            ">√ó</button>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
        <div style="
            background: #f8f9ff; padding: ${isMobile ? '15px' : '20px'}; 
            border-radius: ${isMobile ? '10px' : '12px'};
            border-left: 4px solid #667eea; flex-grow: 1;
            overflow-y: auto; margin-bottom: ${isMobile ? '15px' : '20px'}; 
            font-size: ${isMobile ? '14px' : '15px'};
        ">
            <div style="white-space: pre-wrap; line-height: 1.6; color: #333;">
                ${content}
            </div>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <div style="
            display: flex; gap: ${isMobile ? '10px' : '15px'}; 
            justify-content: ${isMobile ? 'space-between' : 'center'};
            ${isMobile ? 'flex-direction: column;' : ''}
        ">
            <button onclick="saveCurrentAdvice('${title.replace(/'/g, "\\'")}')" style="
                background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%); 
                color: white; border: none;
                padding: 12px 25px; border-radius: 8px; cursor: pointer;
                font-weight: 600; font-size: 14px; display: flex; align-items: center;
                justify-content: center; gap: 8px; flex: ${isMobile ? '1' : 'none'};
                transition: all 0.3s;
            ">
                <i class="fas fa-download" style="font-size: 16px;"></i>
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
            </button>
            
            <button onclick="printCurrentAdvice('${title.replace(/'/g, "\\'")}')" style="
                background: linear-gradient(135deg, #2196F3 0%, #0D47A1 100%); 
                color: white; border: none;
                padding: 12px 25px; border-radius: 8px; cursor: pointer;
                font-weight: 600; font-size: 14px; display: flex; align-items: center;
                justify-content: center; gap: 8px; flex: ${isMobile ? '1' : 'none'};
                transition: all 0.3s;
            ">
                <i class="fas fa-print" style="font-size: 16px;"></i>
                –ü–µ—á–∞—Ç—å
            </button>
            
            <button onclick="document.getElementById('ai-result-modal').remove()" style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                color: white; border: none;
                padding: 12px 25px; border-radius: 8px; cursor: pointer;
                font-weight: 600; font-size: 14px; display: flex; align-items: center;
                justify-content: center; gap: 8px; flex: ${isMobile ? '1' : 'none'};
                transition: all 0.3s;
            ">
                <i class="fas fa-times" style="font-size: 16px;"></i>
                –ó–∞–∫—Ä—ã—Ç—å
            </button>
        </div>
    </div>
</div>`;

            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏
            setTimeout(() => {
                const buttons = document.querySelectorAll('#ai-result-modal button');
                buttons.forEach(btn => {
                    btn.addEventListener('mouseenter', function () {
                        this.style.transform = 'translateY(-2px)';
                        this.style.boxShadow = '0 5px 15px rgba(0,0,0,0.2)';
                    });
                    btn.addEventListener('mouseleave', function () {
                        this.style.transform = 'translateY(0)';
                        this.style.boxShadow = 'none';
                    });
                });
            }, 100);
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—á–∞—Ç–∏ —Ç–µ–∫—É—â–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
        function printCurrentAdvice(title) {
            const contentDiv = document.querySelector('#ai-result-modal [style*="background: #f8f9ff"] div');
            if (contentDiv) {
                const content = contentDiv.textContent || contentDiv.innerText;

                // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–µ—á–∞—Ç–∏
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
            <!DOCTYPE html>
            <html lang="ru">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>${title}</title>
                <style>
                    body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; }
                    .header { text-align: center; margin-bottom: 30px; }
                    .title { color: #667eea; font-size: 24px; margin-bottom: 10px; }
                    .date { color: #666; font-size: 14px; }
                    .content { background: #f8f9ff; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea; }
                    @media print {
                        body { padding: 0; }
                        .no-print { display: none; }
                    }
                </style>
            </head>
            <body>
                <div class="header">
                    <div class="title">${title}</div>
                    <div class="date">–°–æ–∑–¥–∞–Ω–æ: ${new Date().toLocaleString()}</div>
                </div>
                <div class="content">${content.replace(/\n/g, '<br>')}</div>
                <div class="no-print" style="text-align: center; margin-top: 30px;">
                    <button onclick="window.print()" style="
                        background: #667eea; color: white; border: none;
                        padding: 10px 20px; border-radius: 5px; cursor: pointer;
                    ">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
                    <button onclick="window.close()" style="
                        background: #666; color: white; border: none;
                        padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-left: 10px;
                    ">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
                <script>
                    // –ê–≤—Ç–æ–ø–µ—á–∞—Ç—å –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
                    setTimeout(() => window.print(), 500);
                <\/script>
            </body>
            </html>
        `);
                printWindow.document.close();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        function saveAIAdvice(title, content) {
            try {
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
                const text = `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë           ${title.toUpperCase()}           ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

${content}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üìÖ –°–æ–∑–¥–∞–Ω–æ: ${new Date().toLocaleString()}
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${document.getElementById('test-name').value || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
‚ö° –°–∏—Å—Ç–µ–º–∞: –ë–∞–ª–∞–Ω—Å —Ç–µ–ª–∞ AI
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ`;

                // –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª
                const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `AI_—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏_${title.replace(/[^a-z–∞-—è—ë0-9]/gi, '_')}_${Date.now()}.txt`;

                // –î–æ–±–∞–≤–ª—è–µ–º –∏ –∫–ª–∏–∫–∞–µ–º
                document.body.appendChild(a);
                a.click();

                // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –º–æ–¥–∞–ª–∫–µ
                showSaveNotification('‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                showSaveNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
        function showSaveNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
        position: fixed; bottom: 20px; right: 20px; 
        background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
        color: white; padding: 12px 20px; border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 10001;
        animation: slideIn 0.3s ease;
    `;
            notification.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        const style = document.createElement('style');
        style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
        document.head.appendChild(style);

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        function saveCurrentAdvice(title) {
            const contentDiv = document.querySelector('#ai-result-modal [style*="background: #f8f9ff"] div');
            if (contentDiv) {
                const content = contentDiv.textContent || contentDiv.innerText;
                saveAIAdvice(title, content);
            }
        }

        function saveAIAdvice(title, content) {
            try {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
                const text = `=== ${title} ===\n\n${content}\n\n---\n–°–æ–∑–¥–∞–Ω–æ: ${new Date().toLocaleString()}\n`;
                const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });

                // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `AI_—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏_${Date.now()}.txt`;

                // –î–æ–±–∞–≤–ª—è–µ–º, –∫–ª–∏–∫–∞–µ–º –∏ —É–¥–∞–ª—è–µ–º
                document.body.appendChild(a);
                a.click();
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);

                alert(`‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ "${title}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!`);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª');
            }
        }

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(() => console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'))
                .catch(err => console.log('‚ùå –û—à–∏–±–∫–∞ Service Worker:', err));
        }
    </script>


</body>

</html>